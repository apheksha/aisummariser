<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Meeting Summarizer</title>
    <style>
      body{font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 720px; margin: 24px auto; padding: 0 12px}
      textarea,input,button{width:100%; margin:8px 0; padding:8px}
      .row{display:flex; gap:8px}
      .row > *{flex:1}
      .muted{opacity:.8; font-size:.9em}
      .box{border:1px solid #ddd; padding:12px; border-radius:8px}
      .actions{display:flex; gap:8px}
      .actions button{flex:1}
    </style>
  </head>
  <body>
    <h1>AI Meeting Summarizer</h1>

    <div class="box">
      <label>Upload transcript (.txt)</label>
      <input type="file" id="file" accept=".txt"/>

      <label>Or paste transcript</label>
      <textarea id="transcript" rows="8" placeholder="Paste meeting notes or call transcript..."></textarea>

      <label>Instruction / Prompt</label>
      <input id="instruction" placeholder="e.g., Summarize in bullet points for executives"/>

      <div class="actions">
        <button id="genBtn">Generate Summary</button>
        <button id="clearBtn" type="button">Clear</button>
      </div>

      <p class="muted">Tip: You can combine an uploaded file and pasted text—both will be used.</p>
    </div>

    <h2>Summary (editable)</h2>
    <textarea id="summary" rows="14" placeholder="Your AI summary will appear here. You can edit before sharing..."></textarea>

    <div class="box">
      <h3>Share via Email</h3>
      <input id="emails" placeholder="recipient1@example.com, recipient2@example.com"/>
      <input id="subject" placeholder="Subject (optional)"/>
      <button id="sendBtn">Send Email</button>
      <p id="status" class="muted"></p>
    </div>

    <script>
      const byId = (id) => document.getElementById(id);
      const fileEl = byId('file');
      const transcriptEl = byId('transcript');
      const instructionEl = byId('instruction');
      const genBtn = byId('genBtn');
      const clearBtn = byId('clearBtn');
      const summaryEl = byId('summary');
      const emailsEl = byId('emails');
      const subjectEl = byId('subject');
      const sendBtn = byId('sendBtn');
      const statusEl = byId('status');

      clearBtn.onclick = () => {
        fileEl.value = '';
        transcriptEl.value = '';
        instructionEl.value = '';
        summaryEl.value = '';
        emailsEl.value = '';
        subjectEl.value = '';
        statusEl.textContent = '';
      };

      genBtn.onclick = async () => {
        try {
          const form = new FormData();
          if (fileEl.files[0]) form.append('file', fileEl.files[0]);
          form.append('transcript', transcriptEl.value || '');
          form.append('instruction', instructionEl.value || '');

          genBtn.disabled = true; genBtn.textContent = 'Generating...';
          const resp = await fetch('/api/summarize', { method: 'POST', body: form });
          const data = await resp.json();
          if (!resp.ok) throw new Error(data.error || 'Failed');
          summaryEl.value = data.summary || '';
        } catch (e) {
          alert(e.message || 'Failed to generate summary');
        } finally {
          genBtn.disabled = false; genBtn.textContent = 'Generate Summary';
        }
      };

      sendBtn.onclick = async () => {
        try {
          const to = emailsEl.value.trim();
          if (!to) return alert('Enter recipient email(s)');
          const body = summaryEl.value.trim();
          if (!body) return alert('No summary to send');

          sendBtn.disabled = true; sendBtn.textContent = 'Sending...';
          const resp = await fetch('/api/email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ to, subject: subjectEl.value, body })
          });
          const data = await resp.json();
          if (!resp.ok) throw new Error(data.error || 'Failed');
          statusEl.textContent = 'Email sent ✔ (' + (data.messageId || 'ok') + ')';
        } catch (e) {
          statusEl.textContent = 'Email failed: ' + (e.message || 'error');
        } finally {
          sendBtn.disabled = false; sendBtn.textContent = 'Send Email';
        }
      };
    </script>
  </body>
</html>